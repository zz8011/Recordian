# 如何自定义 Preset

## 📝 Preset 文件格式

Preset 文件是 Markdown 格式，代码会自动解析其中的规则并生成对应的 Few-shot prompt。

## 🎯 基本结构

```markdown
# Preset 标题

任务描述（可选）

规则列表：
- 规则 1
- 规则 2
- 规则 3

原文：{text}
```

## 🔍 规则检测机制

代码会自动检测 preset 中的关键词，并生成对应的 Few-shot 示例：

### 1. 数字转换规则

**关键词**：`数字`、`阿拉伯`

**效果**：自动添加数字转换示例

**示例**：
```markdown
- 数字使用阿拉伯数字（1、2、3），不要用中文（一、二、三）
```

**生成的 Few-shot**：
```
输入：我有一二三四五个苹果
输出：我有12345个苹果
输入：第一步打开文件，第二步编辑内容
输出：第1步打开文件，第2步编辑内容
```

### 2. 分段规则

**关键词**：`分段`、`换行`

**效果**：自动添加分段示例

**示例**：
```markdown
- 根据语义自动分段，长句子适当换行
```

**生成的 Few-shot**：
```
输入：首先我们需要准备材料，然后开始制作，最后进行测试
输出：首先我们需要准备材料。
然后开始制作。
最后进行测试。
```

### 3. 正式书面语

**关键词**：`正式`、`书面语`

**效果**：使用正式书面语的 Few-shot 示例

**示例**：
```markdown
# 正式书面语预设

将以下口语转换为正式书面语：
- 删除所有口语化表达和语气词
- 使用正式的书面语词汇
```

**生成的 Few-shot**：
```
输入：嗯，我觉得这个方案还不错，可以试试看
输出：该方案具有可行性，建议尝试实施。
```

### 4. 会议纪要

**关键词**：`会议`、`纪要`

**效果**：使用会议纪要格式的 Few-shot 示例

**示例**：
```markdown
# 会议纪要预设

将以下内容整理为会议纪要格式：
- 使用列表格式
- 每项一行
```

**生成的 Few-shot**：
```
输入：我们今天讨论了项目进度，张三负责前端开发
输出：- 讨论项目进度
- 张三负责前端开发
```

### 5. 技术文档

**关键词**：`技术`、`文档`

**效果**：使用技术文档风格的 Few-shot 示例

**示例**：
```markdown
# 技术文档预设

将以下口语整理为技术文档风格：
- 使用准确的技术术语
- 结构清晰，逻辑严谨
```

**生成的 Few-shot**：
```
输入：这个函数就是用来处理数据的，把输入转成输出
输出：该函数用于数据处理，将输入数据转换为输出格式。
```

## 📋 完整示例

### 示例 1：自定义代码注释 Preset

创建 `presets/code-comment.md`：

```markdown
# 代码注释预设

将以下口语整理为代码注释风格：
- 简洁明了
- 使用技术术语
- 适合作为代码注释
- 数字使用阿拉伯数字

原文：{text}
```

**效果**：
- 因为包含"技术"相关内容，会使用技术文档的 Few-shot
- 因为包含"数字"规则，会添加数字转换示例

### 示例 2：自定义邮件 Preset

创建 `presets/email.md`：

```markdown
# 邮件预设

将以下口语整理为邮件格式：
- 使用正式书面语
- 添加适当的称呼和结尾
- 段落清晰

原文：{text}
```

**效果**：
- 因为包含"正式"和"书面语"，会使用正式书面语的 Few-shot

### 示例 3：自定义笔记 Preset

创建 `presets/note.md`：

```markdown
# 笔记预设

将以下口语整理为笔记格式：
- 去除重复词和语气助词
- 数字使用阿拉伯数字
- 根据语义自动分段

原文：{text}
```

**效果**：
- 因为包含"数字"规则，会添加数字转换示例
- 因为包含"分段"规则，会添加分段示例
- 使用默认的去除重复词和语气助词的 Few-shot

## 🔄 应用自定义 Preset

### 方法 1：修改配置文件

编辑 `~/.config/recordian/hotkey.json`：

```json
{
  "refine_preset": "code-comment"
}
```

然后重启后端：

```bash
pkill -f recordian
recordian-hotkey
```

### 方法 2：使用快捷键切换（如果实现）

按 `Ctrl+Shift+P` 快速切换 preset。

## 💡 高级技巧

### 组合多个规则

你可以在一个 preset 中组合多个规则：

```markdown
# 综合预设

将以下口语整理：
- 去除重复词和语气助词
- 数字使用阿拉伯数字
- 根据语义自动分段
- 使用正式书面语

原文：{text}
```

代码会自动检测所有规则并生成对应的 Few-shot 示例。

### 自定义任务描述

任务描述会影响 Few-shot 的生成：

```markdown
# 自定义预设

将以下技术讨论整理为文档：
- 使用准确的技术术语
- 数字使用阿拉伯数字

原文：{text}
```

因为任务描述包含"技术"和"文档"，会使用技术文档的 Few-shot。

## 🎯 最佳实践

1. **明确任务描述**：清楚地描述你想要的输出风格
2. **使用关键词**：使用"正式"、"技术"、"会议"等关键词触发特定的 Few-shot
3. **列出具体规则**：使用列表格式列出具体的处理规则
4. **测试和调整**：创建 preset 后测试效果，根据需要调整

## 🐛 故障排查

### 问题 1：修改 preset 后没有效果

**解决**：重启后端
```bash
pkill -f recordian
recordian-hotkey
```

### 问题 2：输出不符合预期

**解决**：
1. 检查 preset 文件中的关键词是否正确
2. 确认规则描述是否清晰
3. 查看日志了解实际使用的 Few-shot

### 问题 3：不知道使用了哪个 Few-shot

**解决**：查看日志
```bash
tail -f ~/.local/share/recordian/logs/hotkey.log
```

## 📚 参考

- [默认 Preset](default.md)
- [正式书面语 Preset](formal.md)
- [技术文档 Preset](technical.md)
- [会议纪要 Preset](meeting.md)
- [代码注释 Preset](code-comment.md)
